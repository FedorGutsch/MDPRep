# Телеграм-бот для рекомендации фильмов

Персональная система рекомендации фильмов на основе векторных представлений с использованием модели E5 для описаний и TF-IDF для жанров.

## Структура проекта

```
movie_recommendation_bot/
├── bot.py                 # Основной файл телеграм-бота
├── database.py            # Модуль работы с базой данных SQLite3
├── init_database.py       # Скрипт инициализации БД и вычисления векторов
├── config.py              # Конфигурация (токен бота)
├── preprocessFunc.py      # Функции предобработки текста
├── requirements.txt       # Зависимости проекта
├── data/
│   └── kp_final.csv       # Данные о фильмах
├── movies_bot.db          # База данных SQLite (создается автоматически)
└── README.md              # Этот файл
```

## Установка

1. Установите зависимости:
```bash
pip install -r requirements.txt
```

2. Убедитесь, что файл `data/kp_final.csv` находится на месте.

3. Настройте токен бота в файле `config.py`:
```python
TELEGRAM_TOKEN = 'ваш_токен_бота'
```

## Инициализация базы данных

Перед запуском бота необходимо инициализировать базу данных и вычислить векторы фильмов:

```bash
python init_database.py
```

Этот процесс может занять некоторое время, так как модель E5 кодирует все описания фильмов.

## Запуск бота

После инициализации базы данных запустите бота:

```bash
python bot.py
```

## Функционал

### Для новых пользователей:
- При команде `/start` пользователь оценивает 5 случайных фильмов из топа (рейтинг >= 8.0)
- Каждый фильм можно оценить от 1 до 5 звезд или пропустить кнопкой "Не смотрел"
- После оценки 5 фильмов создается персональный вектор пользователя на основе взвешенного среднего векторов оцененных фильмов

### Для пользователей после калибровки:
- Бот рекомендует фильмы на основе косинусного сходства с персональным вектором
- Кнопка "Еще одну рекомендацию" позволяет получить новые рекомендации
- Бот выбирает случайный фильм из топ-5 наиболее похожих для разнообразия

## Технические детали

- **База данных**: SQLite3 с тремя таблицами:
  - `users` - пользователи и их персональные векторы
  - `movies` - оригинальные данные о фильмах
  - `movie_vectors` - векторы фильмов

- **Модели**:
  - E5 (multilingual-e5-small) для векторного представления описаний
  - TF-IDF для векторного представления жанров
  - Комбинированный вектор = объединение E5 и TF-IDF векторов

- **Алгоритм рекомендаций**:
  - Вычисление косинусного сходства между персональным вектором пользователя и векторами всех фильмов
  - Выбор случайного фильма из топ-5 наиболее похожих

